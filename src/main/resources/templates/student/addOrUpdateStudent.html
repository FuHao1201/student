<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>编辑学生</title>
    <link rel="stylesheet" href="/layui/css/layui.css">
    <link rel="stylesheet" href="/css/common.css" media="all">
</head>
<body>
<form class="layui-form" action="" lay-filter="formData">
    <br>
    <div class="layui-tools" style="padding-left: 15px;">
        <a href="#" class="layui-btn layui-btn-sm" lay-submit><i class="layui-icon layui-icon-ok"></i>保存</a>
    </div>
    <br>
    <div class="layui-padding-15 auto-height">
        <input type="hidden" id="id" name="id" th:value="${major.id}" class="layui-input">
        <input type="hidden" id="yearOld" th:value="${major.year}" class="layui-input">
        <div class="layui-form-item">
            <label class="layui-form-label">入学年份：</label>
            <div class="layui-input-inline layui-form" lay-filter="yearDiv">
                <select name="year" id="year" placeholder="入学年份" lay-filter="year" lay-verify="required" th:value="${major.year}">
                    <option value="">请选择入学年份</option>
                    <option th:each="year,yearStat:${years}" th:value="${year.year}" th:text="${year.year}"></option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">学院名称：</label>
            <div class="layui-input-inline layui-form" lay-filter="collegeId">
                <select name="collegeId" id="collegeId" placeholder="学院名称" lay-verify="required" th:value="${major.collegeId}">
                    <option th:each="college,collegeStat:${colleges}" th:value="${college.id}" th:text="${college.name}"></option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">专业名：</label>
            <div class="layui-input-inline">
                <input type="text" placeholder="专业名" th:value="${major.name}" name="name" lay-verify="required" autocomplete="off" class="layui-input" width="60px">
            </div>
        </div>
    </div>
</form>
</body>
<script type="text/javascript" src="/layui/layui.js"></script>
<script>
    layui.use(['form','layer', 'laydate'], function(){
        var _form = layui.form, _layer = layui.layer,_laydate = layui.laydate;
        var $ = layui.$;
        //年选择器
        _laydate.render({
            elem: '#year'
            ,type: 'year'
            ,trigger: 'click'
        });
        _form.on("submit",function (data) {//保存点击监听
            $.post("/majorInfo/addOrUpdateMajor",data.field,function(res) {
                if(res.code == "SUCCESS"){
                    _layer.msg(res.message,{icon: 1});
                }else{
                    _layer.msg(res.message,{icon: 2});
                }
            });
            return false;
        });
        //下拉框监听
        _form.on('select(year)',function(data){
            getCollege(data.value);
        });

        if ($("#yearOld").val() != '' && $("#yearOld").val() != null){
            $("#year").val($("#yearOld").val());
            _form.render('select','yearDiv');
        }

        function getCollege(year) {
            $.get("/collegeInfo/getCollege",{year : year},function (res) {
                $('#collegeId').html('');
                $('#collegeId').append(new Option("请选择学院", ''));
                for (let i = 0; i < res.data.length; i++) {
                    $('#collegeId').append(new Option(res.data[i].name, res.data[i].id)); // 第一个是显示的文本，第二个是key值
                }
                _form.render('select','collegeId');
            })
        };
    });
</script>
</html>